@if (boutique(); as b) {
  <div class="boutique-detail-page">
    <!-- Back Button -->
    <nav class="breadcrumb">
      <a routerLink="/acheteur/boutiques" class="breadcrumb__link">
        <span class="material-symbols-outlined">arrow_back</span>
        Retour aux boutiques
      </a>
    </nav>

    <!-- Banner Section -->
    <div class="boutique-banner">
      @if (b.bannerUrl) {
        <div class="banner-image">
          <img [src]="b.bannerUrl" [alt]="b.name" />
        </div>
      } @else {
        <div class="banner-placeholder">
          <span class="material-symbols-outlined">storefront</span>
        </div>
      }
      <div class="banner-overlay">
        <div class="banner-content">
          <div class="banner-header">
            <div class="banner-info">
              <h1 class="boutique-name">{{ b.name }}</h1>
              <div class="boutique-meta">
                <span class="boutique-category">{{ getCategoryLabel(b.category) }}</span>
                <span class="boutique-rating">
                  <span class="material-symbols-outlined">star</span>
                  <span class="rating-value">{{ b.rating }}</span>
                  <span class="rating-count">({{ b.reviewCount }} avis)</span>
                </span>
              </div>
            </div>
            <div class="banner-actions">
              <button 
                class="btn-favorite"
                [class.btn-favorite--active]="isFavorite()"
                (click)="toggleFavorite()"
                [attr.aria-label]="isFavorite() ? 'Retirer des favoris' : 'Ajouter aux favoris'"
              >
                <span class="material-symbols-outlined">{{ isFavorite() ? 'favorite' : 'favorite_border' }}</span>
              </button>
              <span class="status-badge" [class.status-badge--open]="b.isOpen" [class.status-badge--closed]="!b.isOpen">
                <span class="material-symbols-outlined">{{ b.isOpen ? 'check_circle' : 'cancel' }}</span>
                {{ b.isOpen ? 'Ouvert' : 'Fermé' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="boutique-content">
      <!-- Left Column: Info Sections -->
      <div class="boutique-info-column">
        <!-- Description Section -->
        <div class="info-card">
          <h2 class="info-card__title">
            <span class="material-symbols-outlined">description</span>
            Description
          </h2>
          <p class="boutique-description">{{ b.description }}</p>
        </div>

        <!-- Contact Info Section -->
        <div class="info-card">
          <h2 class="info-card__title">
            <span class="material-symbols-outlined">contact_support</span>
            Informations de contact
          </h2>
          <div class="contact-list">
            @if (b.phone) {
              <div class="contact-item">
                <span class="material-symbols-outlined">phone</span>
                <a [href]="'tel:' + b.phone" class="contact-link">{{ b.phone }}</a>
              </div>
            }
            @if (b.email) {
              <div class="contact-item">
                <span class="material-symbols-outlined">email</span>
                <a [href]="'mailto:' + b.email" class="contact-link">{{ b.email }}</a>
              </div>
            }
            @if (b.website) {
              <div class="contact-item">
                <span class="material-symbols-outlined">language</span>
                <a [href]="'https://' + b.website" target="_blank" rel="noopener noreferrer" class="contact-link">{{ b.website }}</a>
              </div>
            }
          </div>
        </div>

        <!-- Location Info Section -->
        <div class="info-card">
          <h2 class="info-card__title">
            <span class="material-symbols-outlined">location_on</span>
            Localisation
          </h2>
          <div class="location-info">
            <div class="location-item">
              <span class="material-symbols-outlined">layers</span>
              <span>Étage {{ b.floor }}</span>
            </div>
            @if (b.zone) {
              <div class="location-item">
                <span class="material-symbols-outlined">map</span>
                <span>{{ b.zone }}</span>
              </div>
            }
          </div>
        </div>

        <!-- Opening Hours Section -->
        <div class="info-card">
          <h2 class="info-card__title">
            <span class="material-symbols-outlined">schedule</span>
            Horaires d'ouverture
          </h2>
          <div class="hours-table">
            <table>
              <tbody>
                @for (hour of b.hours; track hour.day) {
                  <tr [class.hours-row--today]="hour.day === getCurrentDay()">
                    <td class="hours-day">{{ hour.day }}</td>
                    <td class="hours-time">
                      @if (hour.open && hour.close) {
                        {{ hour.open }} - {{ hour.close }}
                      } @else {
                        <span class="hours-closed">Fermé</span>
                      }
                    </td>
                    @if (hour.day === getCurrentDay()) {
                      <td class="hours-today-badge">
                        <span class="material-symbols-outlined">today</span>
                        Aujourd'hui
                      </td>
                    }
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Right Column: Products & Reviews -->
      <div class="boutique-products-column">
        <!-- Products Section -->
        <div class="products-section">
          <h2 class="section-title">
            <span class="material-symbols-outlined">inventory_2</span>
            Produits disponibles
          </h2>
          @if (products().length > 0) {
            <div class="products-grid">
              @for (product of products().slice(0, 6); track product.id) {
                <a [routerLink]="['/acheteur/produits', product.id]" class="product-card">
                  <div class="product-card__image">
                    @if (product.imageUrl) {
                      <img [src]="product.imageUrl" [alt]="product.name" />
                    } @else {
                      <span class="material-symbols-outlined">image</span>
                    }
                    @if (product.promoPrice) {
                      <span class="product-card__promo">Promo</span>
                    }
                    @if (product.stock === 0) {
                      <span class="product-card__out-of-stock">Rupture</span>
                    }
                  </div>
                  <div class="product-card__content">
                    <h3 class="product-card__name">{{ product.name }}</h3>
                    <div class="product-card__price">
                      @if (product.promoPrice) {
                        <span class="price-promo">{{ formatCurrency(product.promoPrice) }}</span>
                        <span class="price-original">{{ formatCurrency(product.price) }}</span>
                      } @else {
                        <span class="price-current">{{ formatCurrency(product.price) }}</span>
                      }
                    </div>
                    <div class="product-card__rating">
                      <span class="material-symbols-outlined">star</span>
                      <span>{{ product.rating }}</span>
                    </div>
                  </div>
                </a>
              }
            </div>
          } @else {
            <div class="empty-state">
              <span class="material-symbols-outlined">inventory_2</span>
              <p>Aucun produit disponible</p>
            </div>
          }
        </div>

        <!-- Reviews Section -->
        <div class="reviews-section">
          <h2 class="section-title">
            <span class="material-symbols-outlined">reviews</span>
            Avis clients ({{ reviews().length }})
          </h2>
          @if (reviews().length > 0) {
            <div class="reviews-list">
              @for (review of reviews(); track review.id) {
                <div class="review-card">
                  <div class="review-header">
                    <div class="review-user">
                      @if (review.userAvatar) {
                        <img [src]="review.userAvatar" [alt]="review.userName" class="review-avatar" />
                      } @else {
                        <div class="review-avatar-placeholder">
                          <span class="material-symbols-outlined">person</span>
                        </div>
                      }
                      <div class="review-user-info">
                        <span class="review-user-name">{{ review.userName }}</span>
                        <span class="review-date">{{ formatDate(review.date) }}</span>
                      </div>
                    </div>
                    <div class="review-rating">
                      @for (star of [1,2,3,4,5]; track star) {
                        <span 
                          class="material-symbols-outlined star"
                          [class.star--filled]="star <= review.rating"
                        >star</span>
                      }
                    </div>
                  </div>
                  <p class="review-comment">{{ review.comment }}</p>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <span class="material-symbols-outlined">reviews</span>
              <p>Aucun avis pour le moment</p>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
}
