<div class="discovery-page">
  <!-- Header -->
  <div class="discovery-header">
    <h1>
      <span class="material-symbols-outlined">store</span>
      Découvrir les boutiques
    </h1>
    <p class="discovery-header__subtitle">Explorez toutes les boutiques du centre commercial</p>
  </div>

  <!-- Search and Filters Section -->
  <div class="filters-section">
    <!-- Search Bar -->
    <div class="search-bar">
      <span class="material-symbols-outlined">search</span>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        placeholder="Rechercher une boutique, une catégorie..."
        class="search-input"
      />
      @if (searchQuery()) {
        <button class="search-clear" (click)="searchQuery.set('')">
          <span class="material-symbols-outlined">close</span>
        </button>
      }
    </div>

    <!-- Filters Row -->
    <div class="filters-row">
      <!-- Category Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <span class="material-symbols-outlined">category</span>
          Catégorie
        </label>
        <select [(ngModel)]="selectedCategory" class="filter-select">
          <option value="">Toutes les catégories</option>
          @for (cat of categories; track cat.value) {
            <option [value]="cat.value">{{ cat.label }}</option>
          }
        </select>
      </div>

      <!-- Floor Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <span class="material-symbols-outlined">layers</span>
          Étage
        </label>
        <select [(ngModel)]="selectedFloor" class="filter-select">
          <option value="">Tous les étages</option>
          @for (floor of floors(); track floor) {
            <option [value]="floor">Étage {{ floor }}</option>
          }
        </select>
      </div>

      <!-- Open Now Checkbox -->
      <div class="filter-group filter-group--checkboxes">
        <label class="filter-checkbox">
          <input type="checkbox" [(ngModel)]="onlyOpen" />
          <span class="material-symbols-outlined">schedule</span>
          Ouvert maintenant
        </label>
      </div>
    </div>

    <!-- Sort and View Controls -->
    <div class="controls-row">
      <!-- Sort Options -->
      <div class="sort-section">
        <label class="sort-label">
          <span class="material-symbols-outlined">sort</span>
          Trier par:
        </label>
        <div class="sort-options">
          <button
            class="sort-btn"
            [class.sort-btn--active]="sortBy() === 'name'"
            (click)="setSortBy('name')"
          >
            Nom
          </button>
          <button
            class="sort-btn"
            [class.sort-btn--active]="sortBy() === 'rating'"
            (click)="setSortBy('rating')"
          >
            Note
          </button>
          <button
            class="sort-btn"
            [class.sort-btn--active]="sortBy() === 'popularity'"
            (click)="setSortBy('popularity')"
          >
            Popularité
          </button>
        </div>
      </div>

      <!-- View Mode Toggle -->
      <div class="view-toggle">
        <button
          class="view-btn"
          [class.view-btn--active]="viewMode() === 'grid'"
          (click)="setViewMode('grid')"
          title="Vue grille"
        >
          <span class="material-symbols-outlined">grid_view</span>
        </button>
        <button
          class="view-btn"
          [class.view-btn--active]="viewMode() === 'list'"
          (click)="setViewMode('list')"
          title="Vue liste"
        >
          <span class="material-symbols-outlined">view_list</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Results Count -->
  <div class="results-info">
    <span class="results-count">{{ filteredBoutiques().length }} boutique(s) trouvée(s)</span>
  </div>

  <!-- Boutiques Grid/List -->
  @if (filteredBoutiques().length > 0) {
    <div class="boutiques-container" [class.boutiques-container--grid]="viewMode() === 'grid'" [class.boutiques-container--list]="viewMode() === 'list'">
      @for (boutique of filteredBoutiques(); track boutique.id) {
        <a [routerLink]="['/acheteur/boutiques', boutique.id]" class="boutique-card">
          <div class="boutique-card__logo">
            @if (boutique.logoUrl) {
              <img [src]="boutique.logoUrl" [alt]="boutique.name" />
            } @else {
              <span class="material-symbols-outlined">store</span>
            }
            @if (boutique.isOpen) {
              <span class="boutique-card__status boutique-card__status--open">
                <span class="material-symbols-outlined">check_circle</span>
                Ouvert
              </span>
            } @else {
              <span class="boutique-card__status boutique-card__status--closed">
                <span class="material-symbols-outlined">cancel</span>
                Fermé
              </span>
            }
          </div>
          <div class="boutique-card__content">
            <div class="boutique-card__header">
              <h3 class="boutique-card__name">{{ boutique.name }}</h3>
              <span class="boutique-card__category">{{ getCategoryLabel(boutique.category) }}</span>
            </div>
            <p class="boutique-card__description">{{ boutique.description }}</p>
            <div class="boutique-card__meta">
              <div class="boutique-card__rating">
                <span class="material-symbols-outlined filled-icon">star</span>
                <span class="rating-value">{{ boutique.rating }}</span>
                <span class="rating-count">({{ boutique.reviewCount }})</span>
              </div>
              <div class="boutique-card__floor">
                <span class="material-symbols-outlined">layers</span>
                Étage {{ boutique.floor }}
                @if (boutique.zone) {
                  <span class="boutique-card__zone">• {{ boutique.zone }}</span>
                }
              </div>
            </div>
          </div>
        </a>
      }
    </div>
  } @else {
    <div class="empty-state">
      <span class="material-symbols-outlined">store</span>
      <h3>Aucune boutique trouvée</h3>
      <p>Essayez de modifier vos critères de recherche ou vos filtres</p>
    </div>
  }
</div>
