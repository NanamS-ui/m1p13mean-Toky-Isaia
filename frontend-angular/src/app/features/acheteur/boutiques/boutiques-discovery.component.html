<div class="discovery-page">
  <!-- Header -->
  <div class="discovery-header">
    <h1>
      <span class="material-symbols-outlined">store</span>
      Découvrir les boutiques
    </h1>
    <p class="discovery-header__subtitle">Explorez toutes les boutiques du centre commercial</p>
  </div>

  <!-- Search and Filters Section -->
  <div class="filters-section">
    <!-- Search Bar -->
    <div class="search-bar">
      <span class="material-symbols-outlined">search</span>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        placeholder="Rechercher une boutique, une catégorie..."
        class="search-input"
      />
      @if (searchQuery()) {
        <button class="search-clear" (click)="searchQuery.set('')">
          <span class="material-symbols-outlined">close</span>
        </button>
      }
    </div>

    <!-- Filters Row -->
    <div class="filters-row">
      <!-- Category Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <span class="material-symbols-outlined">category</span>
          Catégorie
        </label>
        <select [(ngModel)]="selectedCategory" class="filter-select">
          <option value="">Toutes les catégories</option>
          @for (cat of categories; track cat.value) {
            <option [value]="cat.value">{{ cat.label }}</option>
          }
        </select>
      </div>

      <!-- Floor Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <span class="material-symbols-outlined">layers</span>
          Étage
        </label>
        <select
          [ngModel]="selectedFloor()"
          (ngModelChange)="onFloorChange($event)"
          class="filter-select"
        >
          <option [ngValue]="''">Tous les étages</option>
          @for (floor of floors(); track floor) {
            <option [ngValue]="floor">{{ getFloorLabel(floor) }}</option>
          }
        </select>
      </div>

      <!-- Open Now Checkbox -->
      <div class="filter-group filter-group--checkboxes">
        <label class="filter-checkbox">
          <input type="checkbox" [(ngModel)]="onlyOpen" />
          <span class="material-symbols-outlined">schedule</span>
          Ouvert maintenant
        </label>
      </div>
    </div>

    <!-- Sort and View Controls -->
    <div class="controls-row">
      <!-- Sort Options -->
      <div class="sort-section">
        <label class="sort-label">
          <span class="material-symbols-outlined">sort</span>
          Trier par:
        </label>
        <div class="sort-options">
          <button
            class="sort-btn"
            [class.sort-btn--active]="sortBy() === 'name'"
            (click)="setSortBy('name')"
          >
            Nom
          </button>
          <button
            class="sort-btn"
            [class.sort-btn--active]="sortBy() === 'rating'"
            (click)="setSortBy('rating')"
          >
            Note
          </button>
          <button
            class="sort-btn"
            [class.sort-btn--active]="sortBy() === 'popularity'"
            (click)="setSortBy('popularity')"
          >
            Popularité
          </button>
        </div>
      </div>

      <!-- View Mode Toggle -->
      <div class="view-toggle">
        <button
          class="view-btn"
          [class.view-btn--active]="viewMode() === 'grid'"
          (click)="setViewMode('grid')"
          title="Vue grille"
        >
          <span class="material-symbols-outlined">grid_view</span>
        </button>
        <button
          class="view-btn"
          [class.view-btn--active]="viewMode() === 'list'"
          (click)="setViewMode('list')"
          title="Vue liste"
        >
          <span class="material-symbols-outlined">view_list</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Results Count -->
  <div class="results-info">
    <span class="results-count">{{ filteredBoutiques().length }} boutique(s) trouvée(s)</span>
  </div>

  <!-- Boutiques Grid/List -->
  @if (filteredBoutiques().length > 0) {
    <div class="boutiques-container" [class.boutiques-container--grid]="viewMode() === 'grid'" [class.boutiques-container--list]="viewMode() === 'list'">
      @for (boutique of filteredBoutiques(); track boutique.id) {
        <article class="boutique-card">
          <a [routerLink]="['/acheteur/boutiques', boutique.id]" class="boutique-card__link">
            <div class="boutique-card__media">
              @if (boutique.logoUrl) {
                <img [src]="boutique.logoUrl" [alt]="boutique.name" class="boutique-card__img" />
              } @else {
                <div class="boutique-card__placeholder">
                  <span class="material-symbols-outlined">store</span>
                </div>
              }
              <span class="boutique-card__badge" [class.boutique-card__badge--open]="boutique.isOpen" [class.boutique-card__badge--closed]="!boutique.isOpen">
                <span class="material-symbols-outlined">{{ boutique.isOpen ? 'check_circle' : 'cancel' }}</span>
                {{ boutique.isOpen ? 'Ouvert' : 'Fermé' }}
              </span>
            </div>
            <div class="boutique-card__body">
              <span class="boutique-card__category">{{ getCategoryLabel(boutique.category) }}</span>
              <h3 class="boutique-card__name">{{ boutique.name }}</h3>
              @if (boutique.description) {
                <p class="boutique-card__description">{{ boutique.description }}</p>
              }
              <div class="boutique-card__footer">
                <div class="boutique-card__location">
                  <span class="material-symbols-outlined">location_on</span>
                  <span>{{ getFloorLabel(boutique.floor) }}@if (boutique.zone) { • {{ boutique.zone }} }</span>
                </div>
                <div class="boutique-card__rating">
                  <span class="material-symbols-outlined filled-icon">star</span>
                  <span>{{ boutique.rating }}</span>
                  <span class="rating-count">({{ boutique.reviewCount }} avis)</span>
                </div>
              </div>
            </div>
          </a>
          <a [routerLink]="['/acheteur/carte']" [queryParams]="{ floor: boutique.floor }" class="boutique-card__map-link" title="Voir sur la carte">
            <span class="material-symbols-outlined">map</span>
            Carte
          </a>
        </article>
      }
    </div>
  } @else {
    <div class="empty-state">
      <span class="material-symbols-outlined">store</span>
      <h3>Aucune boutique trouvée</h3>
      <p>Essayez de modifier vos critères de recherche ou vos filtres</p>
    </div>
  }
</div>
