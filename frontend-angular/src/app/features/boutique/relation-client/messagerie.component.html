<div class="messagerie-page">
  <div class="page-header">
    <h2>Messagerie</h2>
    @if (totalUnread() > 0) {
      <span class="unread-badge">{{ totalUnread() }} non lu(s)</span>
    }
  </div>

  <div class="chat-container">
    <!-- Conversations List -->
    <div class="conversations-list">
      <div class="conversations-header">
        <input type="text" placeholder="Rechercher une conversation..." class="search-input" />
      </div>
      <div class="conversations">
        @for (conv of conversations(); track conv.id) {
          <div class="conversation-item" 
               [class.conversation-item--active]="selectedConversation()?.id === conv.id"
               [class.conversation-item--unread]="conv.unread > 0"
               (click)="selectConversation(conv)">
            <div class="conversation-avatar">
              @if (conv.customer.avatar) {
                <img [src]="conv.customer.avatar" [alt]="conv.customer.name" />
              } @else {
                <span class="material-symbols-outlined">person</span>
              }
            </div>
            <div class="conversation-content">
              <div class="conversation-header">
                <span class="conversation-name">{{ conv.customer.name }}</span>
                <span class="conversation-time">{{ conv.lastMessageTime }}</span>
              </div>
              <p class="conversation-preview">{{ conv.lastMessage }}</p>
            </div>
            @if (conv.unread > 0) {
              <span class="conversation-badge">{{ conv.unread }}</span>
            }
          </div>
        } @empty {
          <div class="empty-conversations">
            <span class="material-symbols-outlined">chat_bubble</span>
            <p>Aucune conversation</p>
          </div>
        }
      </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
      @if (selectedConversation()) {
        <div class="chat-header">
          <div class="chat-user">
            <div class="chat-avatar">
              <span class="material-symbols-outlined">person</span>
            </div>
            <div class="chat-user-info">
              <span class="chat-user-name">{{ selectedConversation()!.customer.name }}</span>
              <span class="chat-user-status">En ligne</span>
            </div>
          </div>
          <div class="chat-actions">
            <button class="action-btn">
              <span class="material-symbols-outlined">more_vert</span>
            </button>
          </div>
        </div>

        <div class="chat-messages">
          @for (msg of selectedConversation()!.messages; track msg.id) {
            <div class="message" [class.message--sent]="msg.sender === 'shop'" [class.message--received]="msg.sender === 'customer'">
              <div class="message-content">
                <p>{{ msg.content }}</p>
                <span class="message-time">{{ msg.timestamp }}</span>
              </div>
            </div>
          }
        </div>

        <div class="chat-input">
          <input type="text" 
                 [(ngModel)]="newMessage" 
                 (keyup.enter)="sendMessage()"
                 placeholder="Écrire un message..." />
          <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessage.trim()">
            <span class="material-symbols-outlined">send</span>
          </button>
        </div>
      } @else {
        <div class="no-conversation">
          <span class="material-symbols-outlined">forum</span>
          <h4>Sélectionnez une conversation</h4>
          <p>Choisissez une conversation dans la liste pour commencer</p>
        </div>
      }
    </div>
  </div>
</div>
