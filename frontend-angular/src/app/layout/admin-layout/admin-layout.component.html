<div class="admin-layout">
  <aside class="sidebar" [class.sidebar--collapsed]="!sidebarOpen">
    <div class="sidebar__brand">
      <span class="sidebar__logo">K</span>
      @if (sidebarOpen) {
        <span class="sidebar__title">KORUS Center</span>
      }
    </div>
    <nav class="sidebar__nav">
      @for (item of navItems; track item.route) {
        @if (item.children) {
          <div class="nav-group" [class.nav-group--open]="sidebarOpen && isGroupOpen(item.route)">
            <div class="nav-parent">
              <a [routerLink]="item.route"
                 routerLinkActive="active"
                 [routerLinkActiveOptions]="{ exact: false }"
                 class="nav-item nav-item--parent">
                <span class="material-symbols-outlined nav-item__icon">{{ item.icon }}</span>
                @if (sidebarOpen) {
                  <span class="nav-item__label">{{ item.label }}</span>
                }
              </a>
              @if (sidebarOpen) {
                <button type="button"
                        class="nav-parent__toggle"
                        (click)="toggleGroup(item.route, $event)"
                        [attr.aria-label]="isGroupOpen(item.route) ? 'Replier la section' : 'Déplier la section'">
                  <span class="material-symbols-outlined">{{ isGroupOpen(item.route) ? 'expand_less' : 'expand_more' }}</span>
                </button>
              }
            </div>

            @if (sidebarOpen && isGroupOpen(item.route)) {
              <div class="nav-children">
                @for (child of item.children; track child.route) {
                  <a [routerLink]="child.route"
                     routerLinkActive="active"
                     [routerLinkActiveOptions]="{ exact: true }"
                     class="nav-item nav-item--child">
                    {{ child.label }}
                  </a>
                }
              </div>
            }
          </div>
        } @else {
          <a [routerLink]="item.route" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="nav-item">
            <span class="material-symbols-outlined nav-item__icon">{{ item.icon }}</span>
            @if (sidebarOpen) {
              <span>{{ item.label }}</span>
            }
          </a>
        }
      }
    </nav>
    <button type="button" class="sidebar__toggle" (click)="sidebarOpen = !sidebarOpen" [attr.aria-label]="sidebarOpen ? 'Réduire le menu' : 'Ouvrir le menu'">
      <span class="material-symbols-outlined">{{ sidebarOpen ? 'chevron_left' : 'chevron_right' }}</span>
    </button>
  </aside>
  <div class="main-wrapper">
    <header class="header">
      <h1 class="header__title">Administration</h1>
      <div class="header__actions">
        <span class="user-badge">
          <span class="material-symbols-outlined user-badge__icon">person</span>
          {{ user()?.firstName }} {{ user()?.lastName }}
        </span>
        <button type="button" class="btn btn--ghost" (click)="auth.logout()">
          <span class="material-symbols-outlined">logout</span>
        </button>
      </div>
    </header>
    <main class="content">
      <router-outlet />
    </main>
  </div>
</div>
